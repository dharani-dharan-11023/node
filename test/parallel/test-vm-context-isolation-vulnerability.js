'use strict';

// Test case for VM context isolation vulnerability
// This test demonstrates that fresh VM contexts can escape to the main context

const common = require('../common');
const assert = require('assert');
const vm = require('vm');

// Test that fresh context doesn't have access to process (expected behavior)
{
  const context = vm.createContext({});
  const processType = vm.runInContext('typeof process', context);
  assert.strictEqual(processType, 'undefined', 
    'Fresh context should not have process');
}

// Test the vulnerability: constructor chain escape
{
  const context = vm.createContext({});
  
  // This should fail but currently succeeds due to the vulnerability
  const hasMainProcess = vm.runInContext(
    'typeof this.constructor.constructor("return this")().process', 
    context
  );
  
  // This assertion will fail, demonstrating the vulnerability
  assert.strictEqual(hasMainProcess, 'undefined', 
    'Fresh context should not be able to access main context process via constructor chain');
}